<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ultrasound Follicular/TVS Report</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      .container {
        padding: 20px;
      }

      .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .left-section {
        font-size: 14px;
      }

      .left-section p {
        margin-bottom: 5px;
      }

      .left-section span {
        font-weight: bold;
      }

      .logo-section {
        text-align: center;
      }

      .logo-section img {
        width: 350px;
        height: auto;
      }

      .right-section {
        text-align: right;
        font-size: 14px;
      }

      .logo-section {
        margin-left: 145px;
        margin-top: -30px;
      }

      .right-section p {
        margin-bottom: 5px;
      }

      .right-section strong {
        font-size: 16px;
        font-weight: bold;
      }

      .details-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .details-row {
        display: flex;
        justify-content: space-between;
        gap: 40px;
        padding: 10px 0;
      }

      .details-left,
      .details-right {
        flex: 1;
        display: flex;
        gap: 10px;
        justify-content: space-between;
      }

      .details-left p,
      .details-right p {
        font-size: 16px;
      }

      .details-left span,
      .details-right span {
        font-weight: bold;
        margin-left: 10px;
        color: #646363;
        border-bottom: #8d8b8b 1px solid;
        flex: 1;
      }

      .health-table-section {
        margin-top: 20px;
      }

      .sample-info-left,
      .sample-info-right {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 7px;
      }

      .sample-info-left p,
      .sample-info-right p {
        font-size: 15px;
        color: #444;
        /* margin-bottom: 5px; */
        font-weight: 600;
      }

      .sample-info-left span,
      .sample-info-right span {
        margin-left: 10px;
        font-weight: 500;
        color: #646363;
      }

      .chart-container {
        width: 100%;
        max-width: 300px;
        margin: auto;
        max-height: auto;
      }

      canvas {
        margin-bottom: 40px;
      }

      .bar-chart {
        height: 400px;
        margin-bottom: 0;
      }

      .doctor-name {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 60px 0;

        p {
          font-weight: 500;
        }
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div class="container py-5">
      <div class="text-center mb-4">
        <h2>DETAILED ULTRASOUND FOLLICULAR/TVS REPORT</h2>
      </div>

      <header class="header-container">
        <div class="left-section">
          <p>Date: <span id="formattedDate"></span></p>
        </div>
        <div class="logo-section">
          <img src="../images/logo.png" alt="lifelinkr Logo" />
        </div>
        <div class="right-section">
          <p><strong>IVF CLINIC - CLINIC ADDRESS</strong></p>
          <p>CLINIC ADDRESS STREET,</p>
          <p>CLINIC ADDRESS , CITY AND PINCODE</p>
          <p>Phone No.: 9898988322</p>
        </div>
      </header>

      <!-------Patient Details Section-------->
      <div class="details-section mb-4">
        <div class="details-row">
          <div class="details-left">
            <p>Patient Name:</p>
            <span id="patientName"></span>
          </div>
          <div class="details-right">
            <p>Patient MRN:</p>
            <span id="patientMRN"></span>
          </div>
        </div>
        <div class="details-row">
          <div class="details-left">
            <p>Age:</p>
            <span id="patientAge"></span>
          </div>
          <div class="details-right">
            <p>Gender:</p>
            <span id="patientGender"></span>
          </div>
        </div>
        <div class="details-row">
          <div class="details-left">
            <p>Completed On:</p>
            <span id="completed-on"></span>
          </div>
          <div class="details-right">
            <p>Recorded By:</p>
            <span id="recorded-by"></span>
          </div>
        </div>
        <div class="details-row">
          <div class="details-left">
            <p>Assigned Counselor:</p>
            <span id="assignedCounselor"></span>
          </div>
          <div class="details-right">
            <p>Date of First Visit:</p>
            <span id="financialCounselingDate"></span>
          </div>
        </div>
        <div class="details-row">
          <div class="details-left">
            <p>Assigned Doctor:</p>
            <span id="assignedDoctor"></span>
          </div>
        </div>
      </div>

      <!-- Scan Details -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Scan Details</h5>
          <div class="row">
            <div class="col-md-6 mb-3">
              <strong>Scan Type:</strong> <span>Ultrasound</span>
            </div>
            <div class="col-md-6 mb-3">
              <strong>Indication:</strong> <span>Routine Checkup</span>
            </div>
            <div class="col-md-6 mb-3">
              <strong>Findings:</strong> <span>No abnormalities detected</span>
            </div>
            <div class="col-md-6 mb-3">
              <strong>Endometrial Thickness (ET):</strong> <span>8 mm</span>
            </div>
            <div class="col-md-6 mb-3">
              <strong>Ovarian Volume:</strong> <span>12 cc</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Follicular Monitoring Table -->

      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Follicular Monitoring Table</h5>
          <div class="table-responsive">
            <table class="table table-bordered text-center">
              <thead class="table-light">
                <tr>
                  <th>Day</th>
                  <th>Right Ovary (mm)</th>
                  <th>Left Ovary (mm)</th>
                  <th>Endometrium (mm)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Day 2</td>
                  <td>8.0</td>
                  <td>7.5</td>
                  <td>4.0</td>
                </tr>
                <tr>
                  <td>Day 5</td>
                  <td>10.0</td>
                  <td>9.5</td>
                  <td>5.0</td>
                </tr>
                <tr>
                  <td>Day 9</td>
                  <td>12.5</td>
                  <td>11.0</td>
                  <td>7.0</td>
                </tr>
                <tr>
                  <td>Day 12</td>
                  <td>14.0</td>
                  <td>13.5</td>
                  <td>8.0</td>
                </tr>
                <tr>
                  <td>Day 14</td>
                  <td>18.0</td>
                  <td>17.5</td>
                  <td>10.0</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Follicular Monitoring</h5>
          <div class="table-responsive">
            <table class="table table-bordered text-center">
              <thead class="table-light">
                <tr>
                  <th>Day</th>
                  <th>Right Ovary (mm)</th>
                  <th>Left Ovary (mm)</th>
                  <th>Endometrium (mm)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Day 2</td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Day 5</td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Day 9</td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Day 12</td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
                <tr>
                  <td>Day 14</td>
                  <td></td>
                  <td></td>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div> -->

      <!-- Interpretation -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Interpretation</h5>
          <p><strong>Ovulation Observed:</strong> <span></span></p>
          <p><strong>Comments:</strong> <span></span></p>
        </div>
      </div>

      <!-- Impression -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>

<script>
  // Function to fetch and render patient details
  async function fetchPatientDetails() {
    try {
      // Fetch data from the API
      const response = await axios.get("/embrology/patientAllDetails");
      const data = response.data;
      const patientMRN = data.mr_no || "Data not available";
      document.getElementById("patientMRN").textContent = patientMRN;
      // Render patient name
      const patientName = `${data.firstName || ""} ${data.middleName || ""} ${
        data.lastName || ""
      }`;
      document.getElementById("patientName").textContent =
        patientName.trim() || "Data not available";

      // Calculate Age (Years, Months, Days)
      const age = `${data.age_years || "0"} years, ${
        data.age_months || "0"
      } months, ${data.age_days || "0"} days`;
      document.getElementById("patientAge").textContent = age;

      // Render Gender
      const gender = data.Gender || "Data not available";
      document.getElementById("patientGender").textContent = gender;
    } catch (error) {
      console.error("Error fetching patient details:", error);
      document.getElementById("patientMRN").textContent = "Error loading data";

      document.getElementById("patientName").textContent = "Error loading data";
    }
  }

  // Call the function to fetch and display patient details
  fetchPatientDetails();
</script>

<script>
  // Function to format a date into DD-MM-YYYY format
  function formatDateToDDMMYYYY(dateString) {
    const date = new Date(dateString);
    const day = String(date.getDate()).padStart(2, "0"); // Add leading zero if needed
    const month = String(date.getMonth() + 1).padStart(2, "0"); // Months are zero-indexed
    const year = date.getFullYear();

    return `${day}-${month}-${year}`;
  }

  // Example usage
  const originalDate = Date.now(); // Replace with your dynamic date string
  const formattedDate = formatDateToDDMMYYYY(originalDate);

  // Update the DOM with the formatted date
  document.getElementById("formattedDate").textContent = formattedDate;
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cycleID = "<%= cycleId %>";
    const endpoint = `/embrology/getStimulationDetails?cycleID=${cycleID}`;
    const completedOnElement = document.getElementById("completed-on");
    const recordedByElement = document.getElementById("recorded-by");

    fetch(endpoint)
      .then((response) => {
        if (!response.ok) {
          throw new Error("Failed to fetch data");
        }
        return response.json();
      })
      .then((data) => {
        if (data.stimulationCompletedOn) {
          // Format date to DD-MM-YYYY
          const date = new Date(data.stimulationCompletedOn);
          const formattedDate = `${String(date.getDate()).padStart(
            2,
            "0"
          )}-${String(date.getMonth() + 1).padStart(
            2,
            "0"
          )}-${date.getFullYear()}`;
          completedOnElement.textContent = formattedDate;
        } else {
          completedOnElement.textContent = "No data available";
        }

        if (data.stimulationRecordedBy) {
          recordedByElement.textContent = data.stimulationRecordedBy;
        } else {
          recordedByElement.textContent = "No data available";
        }
      })
      .catch((error) => {
        console.error("Error fetching stimulation details:", error);
        completedOnElement.textContent = "Error loading data";
        recordedByElement.textContent = "Error loading data";
      });
  });
</script>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    try {
      // Retrieve cycleId dynamically from your EJS template
      const cycleId = "<%= cycleId %>";
      console.log("Cycle ID:", cycleId);

      // Fetch data from the API using the cycleId
      const response = await axios.get(
        `/embrology/getCounsellingAllDataByCycleID`,
        {
          params: { cycleID: cycleId }, // Use `cycleID` as per your API
        }
      );

      // Access the data returned from the API response
      const data = response.data;
      console.log("API Response:", data);

      if (data) {
        // Update the DOM with the extracted information
        document.querySelector("#financialCounselingDate").textContent =
          data.financialCounselingDate
            ? new Date(data.financialCounselingDate).toLocaleDateString("en-GB")
            : "N/A";

        document.querySelector("#assignedCounselor").textContent =
          data.assignedCounselor || "N/A";
        document.querySelector("#assignedDoctor").textContent =
          data.assignedDoctor || "N/A";
      } else {
        console.error("No data found for this cycleId.");
      }
    } catch (error) {
      console.error("Error fetching data:", error);
    }
  });
</script>
