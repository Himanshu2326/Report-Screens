<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ultrasound Follicular/TVS Report</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;
      }

      .container {
        padding: 20px;
      }

      .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .left-section {
        font-size: 14px;
      }

      .left-section p {
        margin-bottom: 5px;
      }

      .left-section span {
        font-weight: bold;
      }

      .logo-section {
        text-align: center;
      }

      .logo-section img {
        width: 350px;
        height: auto;
      }

      .logo-section {
        margin-left: 145px;
        margin-top: -30px;
      }
      .right-section {
        text-align: right;
        font-size: 14px;
      }

      .right-section p {
        margin-bottom: 5px;
      }

      .right-section strong {
        font-size: 16px;
        font-weight: bold;
      }

      .details-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .details-row {
        display: flex;
        justify-content: space-between;
        gap: 40px;
        padding: 10px 0;
      }

      .details-left,
      .details-right {
        flex: 1;
        display: flex;
        gap: 10px;
        justify-content: space-between;
      }

      .details-left p,
      .details-right p {
        font-size: 16px;
      }

      .details-left span,
      .details-right span {
        font-weight: bold;
        margin-left: 10px;
        color: #646363;
        border-bottom: #8d8b8b 1px solid;
        flex: 1;
      }

      .health-table-section {
        margin-top: 20px;
      }

      .sample-info-left,
      .sample-info-right {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 7px;
      }

      .sample-info-left p,
      .sample-info-right p {
        font-size: 15px;
        color: #444;
        /* margin-bottom: 5px; */
        font-weight: 600;
      }

      .sample-info-left span,
      .sample-info-right span {
        margin-left: 10px;
        font-weight: 500;
        color: #646363;
      }

      .chart-container {
        width: 100%;
        max-width: 300px;
        margin: auto;
        max-height: auto;
      }

      canvas {
        margin-bottom: 40px;
      }

      .bar-chart {
        height: 400px;
        margin-bottom: 0;
      }

      .doctor-name {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 60px 0;

        p {
          font-weight: 500;
        }
      }
    </style>
  </head>
  <body>
    <div class="container py-5">
      <div class="text-center mb-4">
        <h2>DETAILED ULTRASOUND FOLLICULAR/TVS REPORT</h2>
      </div>

      <header class="header-container">
        <div class="left-section">
          <p>Date: <span id="formattedDate"></span></p>
        </div>
        <div class="logo-section">
          <img src="../images/logo.png" alt="lifelinkr Logo" />
        </div>
        <div class="right-section">
          <p><strong>IVF CLINIC - CLINIC ADDRESS</strong></p>
          <p>CLINIC ADDRESS STREET,</p>
          <p>CLINIC ADDRESS , CITY AND PINCODE</p>
          <p>Phone No.: 9898988322</p>
        </div>
      </header>

      <!-------Patient Details Section-------->
      <div class="details-section mb-4">
        <div class="details-row">
          <div class="details-left">
            <p>Patient Name:</p>
            <span id="patientName"></span>
            <span id="patientName"></span>
          </div>
          <div class="details-right">
            <p>Patient MRN:</p>
            <span id="patientMRN"></span>
            <p>Patient MRN:</p>
            <span id="patientMRN"></span>
          </div>
        </div>
        <div class="details-row">
          <div class="details-left">
            <p>Age:</p>
            <span id="patientAge"></span>
            <span id="patientAge"></span>
          </div>
          <div class="details-right">
            <p>Gender:</p>
            <span id="patientGender"></span>
            <span id="patientGender"></span>
          </div>
        </div>
        <div class="details-row">
          <div class="details-left">
            <p>Date of Scan:</p>
            <span></span>
          </div>
          <div class="details-right">
            <p>Referred By:</p>
            <span></span>
          </div>
        </div>
      </div>

      <!-- Follicular Monitoring Table -->
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">Follicular Monitoring Table</h5>
          <div class="table-responsive">
            <table class="table table-bordered text-center">
              <thead class="table-light">
                <tr>
                  <th>Day</th>
                  <th>Right Ovary (mm)</th>
                  <th>Left Ovary (mm)</th>
                  <th>Endometrium (mm)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Day 2</td>
                  <td>8.0</td>
                  <td>7.5</td>
                  <td>4.0</td>
                  <td>8.0</td>
                  <td>7.5</td>
                  <td>4.0</td>
                </tr>
                <tr>
                  <td>Day 5</td>
                  <td>10.0</td>
                  <td>9.5</td>
                  <td>5.0</td>
                  <td>10.0</td>
                  <td>9.5</td>
                  <td>5.0</td>
                </tr>
                <tr>
                  <td>Day 9</td>
                  <td>12.5</td>
                  <td>11.0</td>
                  <td>7.0</td>
                  <td>12.5</td>
                  <td>11.0</td>
                  <td>7.0</td>
                </tr>
                <tr>
                  <td>Day 12</td>
                  <td>14.0</td>
                  <td>13.5</td>
                  <td>8.0</td>
                  <td>14.0</td>
                  <td>13.5</td>
                  <td>8.0</td>
                </tr>
                <tr>
                  <td>Day 14</td>
                  <td>18.0</td>
                  <td>17.5</td>
                  <td>10.0</td>
                  <td>18.0</td>
                  <td>17.5</td>
                  <td>10.0</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Follicular Monitoring Graph -->
      <div class="card">
        <div class="card-body">
          <h5 class="card-title text-center">Follicular Monitoring Graph</h5>
          <!-- <div class="text-center">
          <canvas id="follicularChart" style="max-width: 700px;"></canvas>
        </div> -->
          <div class="d-flex justify-content-center">
            <div style="width: 50%; height: auto">
              <canvas id="follicularChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const ctx = document.getElementById("follicularChart").getContext("2d");
      const follicularChart = new Chart(ctx, {
        type: "line",
        data: {
          labels: ["Day 2", "Day 5", "Day 9", "Day 12", "Day 14"],
          datasets: [
            {
              label: "Right Ovary (mm)",
              data: [10, 12, 14, 18, 20],
              borderColor: "#FFA500",
              backgroundColor: "transparent",
              borderWidth: 2,
              tension: 0.4,
              pointRadius: 5,
              pointBackgroundColor: "#FFA500",
            },
            {
              label: "Left Ovary (mm)",
              data: [8, 10, 13, 17, 19],
              borderColor: "#FF4500",
              backgroundColor: "transparent",
              borderWidth: 2,
              tension: 0.4,
              pointRadius: 5,
              pointBackgroundColor: "#FF4500",
            },
            {
              label: "Endometrium (mm)",
              data: [6, 7, 8, 9, 10],
              borderColor: "#FF69B4",
              backgroundColor: "transparent",
              borderWidth: 2,
              tension: 0.4,
              pointRadius: 5,
              pointBackgroundColor: "#FF69B4",
            },
          ],
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: "top",
            },
            title: {
              display: true,
              text: "Follicular Monitoring",
              font: {
                size: 18,
              },
            },
          },
          scales: {
            x: {
              title: {
                display: true,
                text: "Days",
              },
            },
            y: {
              title: {
                display: true,
                text: "Size/Thickness (mm)",
              },
              beginAtZero: false,
            },
          },
        },
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>

<script>
  // Function to fetch and render patient details
  async function fetchPatientDetails() {
    try {
      // Fetch data from the API
      const response = await axios.get("/embrology/patientAllDetails");
      const data = response.data;
      const patientMRN = data.mr_no || "Data not available";
      document.getElementById("patientMRN").textContent = patientMRN;
      // Render patient name
      const patientName = `${data.firstName || ""} ${data.middleName || ""} ${
        data.lastName || ""
      }`;
      document.getElementById("patientName").textContent =
        patientName.trim() || "Data not available";

      // Calculate Age (Years, Months, Days)
      const age = `${data.age_years || "0"} years, ${
        data.age_months || "0"
      } months, ${data.age_days || "0"} days`;
      document.getElementById("patientAge").textContent = age;

      // Render Gender
      const gender = data.Gender || "Data not available";
      document.getElementById("patientGender").textContent = gender;
    } catch (error) {
      console.error("Error fetching patient details:", error);
      document.getElementById("patientMRN").textContent = "Error loading data";

      document.getElementById("patientName").textContent = "Error loading data";
    }
  }

  // Call the function to fetch and display patient details
  fetchPatientDetails();
</script>


<script>
  // Function to format a date into DD-MM-YYYY format
  function formatDateToDDMMYYYY(dateString) {
    const date = new Date(dateString);
    const day = String(date.getDate()).padStart(2, "0"); // Add leading zero if needed
    const month = String(date.getMonth() + 1).padStart(2, "0"); // Months are zero-indexed
    const year = date.getFullYear();

    return `${day}-${month}-${year}`;
  }

  // Example usage
  const originalDate = Date.now(); // Replace with your dynamic date string
  const formattedDate = formatDateToDDMMYYYY(originalDate);

  // Update the DOM with the formatted date
  document.getElementById("formattedDate").textContent = formattedDate;
</script>
